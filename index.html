<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ライドツーリングツール（LINE × Google Maps）</title>
  <style>
    html, body {
      height: 100dvh;
      margin: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
    }

    /* ✅ header削除済み（この部分不要） */
    /* header { padding: 10px 16px; background: #06c755; color: white; } */

    /* 地図を全画面に */
    #map {
      width: 100%;
      flex-grow: 1;
      height: 100dvh;
    }

    .panel {
      padding: 12px 16px;
      background:#fff;
    }

    input, select {
      padding: 8px;
      width: 100%;
      margin-bottom: 8px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    button {
      padding: 10px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      background: #06c755;
      color: white;
      width: 100%;
      cursor: pointer;
    }

    button:disabled { opacity: .5; cursor: default; }

    label.chk {
      display:flex;
      align-items:center;
      gap:6px;
      white-space: nowrap;
    }

    .route-options {
      display:flex;
      gap:16px;
      flex-wrap: nowrap;
      margin: 6px 0 10px;
      overflow-x:auto;
    }

    /* フローティングボタン */
    #fabMain {
      position: fixed;
      right: 16px;
      bottom: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #06c755;
      color: white;
      font-size: 26px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 3px 10px rgba(0,0,0,.3);
      cursor: pointer;
      z-index: 1100;
      transition: transform 0.3s;
    }
    #fabMain:hover { transform: scale(1.05); }

    /* スライドパネル */
    #sidePanel {
      position: fixed;
      top: 0;
      right: -260px;
      width: 240px;
      height: 100%;
      background: rgba(255,255,255,0.97);
      box-shadow: -2px 0 8px rgba(0,0,0,.3);
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      transition: right 0.3s ease;
      z-index: 1099;
    }
    #sidePanel.open { right: 0; }
    #sidePanel h2 { font-size: 16px; margin: 0 0 8px 0; color:#06c755; }
    #sidePanel button {
      width: 100%;
      padding: 10px;
      font-size: 15px;
      border-radius: 8px;
      background: #06c755;
      color: white;
    }
    #sidePanel .closeBtn { background: #999; }

    /* 背景オーバーレイ */
    #overlay {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.4);
      display: none;
      z-index: 1098;
    }
    #overlay.show { display: block; }

  </style>
</head>
<body>

  <!-- 操作パネル -->
  <div id="controls" class="panel" style="position:absolute; top:10px; left:50%; transform:translateX(-50%); width:90%; max-width:420px; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.2); z-index:1001; background:rgba(255,255,255,0.95);">
    <div style="display:flex; gap:8px; align-items:center;">
      <input id="start" placeholder="出発地（例：京都駅）" style="flex:1">
      <button type="button" id="btn-loc" style="width:auto;">現在地</button>
    </div>
    <input id="end" placeholder="目的地（例：美山 かやぶきの里）">
    <div class="route-options">
      <label class="chk"><input type="checkbox" id="opt-avoid-highways"> 高速を使わない</label>
      <label class="chk"><input type="checkbox" id="opt-avoid-tolls"> 有料道路を使わない</label>
    </div>
    <button id="makeRoute">ルートを作る</button>
  </div>

  <!-- 地図 -->
  <div id="map"></div>

  <!-- 右下のフローティングボタン -->
  <div id="fabMain">☰</div>

  <!-- スライドパネル -->
  <div id="sidePanel">
    <h2>メニュー</h2>
    <button id="shareBtn" disabled>LINEで共有</button>
    <button id="navBtn" disabled>Googleナビで開く</button>
    <button id="rainToggleBtn" type="button">雨雲レーダー</button>
    <button class="closeBtn" id="closePanel">閉じる</button>
  </div>

  <!-- 背景オーバーレイ -->
  <div id="overlay"></div>

  <!-- Google Maps -->
  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBlN9ik-Y3CpEy3Uw9hXfBq0m2AoZWx_oM&libraries=places&language=ja&region=JP&callback=initMap" async defer></script>

  <script>
    let map, directionsService, directionsRenderer, geocoder;

    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: 35.0116, lng: 135.7681 },
        zoom: 8
      });
      directionsService = new google.maps.DirectionsService();
      directionsRenderer = new google.maps.DirectionsRenderer({ map });
      geocoder = new google.maps.Geocoder();
    }

    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('makeRoute').addEventListener('click', makeRoute);
      document.getElementById('btn-loc').addEventListener('click', fillWithCurrentLocation);

      // スライドパネルの開閉
      const fab = document.getElementById('fabMain');
      const panel = document.getElementById('sidePanel');
      const overlay = document.getElementById('overlay');
      const closeBtn = document.getElementById('closePanel');

      fab.addEventListener('click', () => {
        panel.classList.add('open');
        overlay.classList.add('show');
      });
      closeBtn.addEventListener('click', closePanel);
      overlay.addEventListener('click', closePanel);

      function closePanel(){
        panel.classList.remove('open');
        overlay.classList.remove('show');
      }

      // 雨雲ボタン動作（ダミー）
      document.getElementById('rainToggleBtn').addEventListener('click', ()=>alert("雨雲レーダー起動！"));
    });

    function fillWithCurrentLocation() {
      if (!navigator.geolocation) { alert('位置情報が使えません'); return; }
      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const lat = pos.coords.latitude, lng = pos.coords.longitude, loc = { lat, lng };
          map.setCenter(loc); map.setZoom(12);
          geocoder.geocode({ location: loc }, (results, status) => {
            document.getElementById('start').value =
              (status === 'OK' && results && results[0]) ? results[0].formatted_address : `${lat},${lng}`;
          });
        },
        () => alert('現在地が取得できません')
      );
    }

    function makeRoute() {
      const start = document.getElementById('start').value;
      const end   = document.getElementById('end').value;
      if (!start || !end) return alert("出発地と目的地を入力してください");

      directionsService.route({
        origin: start,
        destination: end,
        travelMode: google.maps.TravelMode.DRIVING
      }, (result, status)=>{
        if(status==="OK"){
          directionsRenderer.setDirections(result);
          document.getElementById('shareBtn').disabled=false;
          document.getElementById('navBtn').disabled=false;
        } else alert("ルートを作れませんでした");
      });
    }
  </script>
</body>
</html>

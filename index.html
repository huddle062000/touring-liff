<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ツーリングルート共有（LINE × Google Maps）</title>
  <style>
    html, body { height: 100%; margin: 0; font-family: sans-serif; }
    header { padding: 10px 16px; background: #06c755; color: white; }
    h1 { font-size: 18px; margin: 0; }
    #map { width: 100%; height: 60vh; }
    .panel { padding: 12px 16px; }
    input { padding: 8px; width: 100%; margin-bottom: 8px; border: 1px solid #ccc; border-radius: 6px; }
    button { padding: 10px; font-size: 16px; border: none; border-radius: 8px; background: #06c755; color: white; width: 100%; }
    button:disabled { opacity: 0.5; }
  </style>
</head>
<body>
  <header><h1>ツーリングルート共有</h1></header>
  <div class="panel">
    <input id="start" placeholder="出発地を入力（例：京都駅）">
    <input id="end" placeholder="目的地を入力（例：美山 かやぶきの里）">
    <button id="makeRoute">ルートを作る</button>
    <button id="shareBtn" disabled>LINEで共有</button>
  </div>
  <div id="map"></div>
  <!-- 距離・時間の表示エリア（追加） -->
  <div class="panel" style="padding-top:8px">
  <div id="summary" style="font-size:14px;line-height:1.6;color:#333"></div>
</div>
<div class="panel" style="padding-top:8px">
  <div id="summary" style="font-size:14px;line-height:1.6;color:#333"></div>
</div>

  <!-- LINE SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    const LIFF_ID = "2008438848-3gJlGQvy"; // ← あなたのLIFF ID
    async function initLIFF() {
      await liff.init({ liffId: LIFF_ID });
      const canShare = liff.isApiAvailable('shareTargetPicker');
      document.getElementById('shareBtn').disabled = !canShare;
    }
    initLIFF();
  </script>

  <!-- Google Maps API -->
  <!-- Google Maps API（initMapを自動実行させる版） -->
  <script>
    const GOOGLE_MAPS_API_KEY = "AIzaSyBlN9ik-Y3CpEy3Uw9hXfBq0m2AoZWx_oM";
  </script>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBlN9ik-Y3CpEy3Uw9hXfBq0m2AoZWx_oM&libraries=places&language=ja&callback=initMap"
    async defer></script>

  <script>
  let map, directionsService, directionsRenderer;
  document.getElementById('makeRoute').addEventListener('click', makeRoute);
  document.getElementById('shareBtn').addEventListener('click', shareOnLINE);

  function initMap() {
    map = new google.maps.Map(document.getElementById('map'), { center: { lat: 35.0116, lng: 135.7681 }, zoom: 9 });
    directionsService = new google.maps.DirectionsService();
    directionsRenderer = new google.maps.DirectionsRenderer({ map });
  }
  window.initMap = initMap;

  async function makeRoute() {
    const start = document.getElementById('start').value;
    const end = document.getElementById('end').value;
    if (!start || !end) { alert('出発地と目的地を入力してください'); return; }
    const req = { origin: start, destination: end, travelMode: google.maps.TravelMode.DRIVING };
    directionsService.route(req, (result, status) => {
if (status === 'OK') {
  directionsRenderer.setDirections(result);
  const leg = result.routes[0].legs[0];

  // ここで画面に表示（追加）
  const s = document.getElementById('summary');
  s.textContent = `距離: ${leg.distance.text}　時間: ${leg.duration.text}`;

  // 共有文も更新（既存）
  window._shareText =
    `出発地: ${leg.start_address}\n目的地: ${leg.end_address}\n距離: ${leg.distance.text}\n時間: ${leg.duration.text}`;

  // 共有ボタンを有効化（追加）
  document.getElementById('shareBtn').disabled = false;

} else {
  alert('ルートを作れませんでした');
  document.getElementById('summary').textContent = '';
}
    });
  }

// ===== 共有ボタン処理（詳しくエラー表示） =====
async function shareOnLINE() {
  try {
    // ① LINEアプリの中で開いているか
    if (!liff.isInClient()) {
      alert('【共有できません】\nLINEアプリ内で開いてください。\n（外部ブラウザでは動作しません）');
      return;
    }

    // ② 共有APIが使える環境か
    if (!liff.isApiAvailable('shareTargetPicker')) {
      alert('【共有できません】\nこの端末のLINEでは共有APIが使えません。\nLINEアプリを最新に更新して再試行してください。');
      return;
    }

    // ③ まずルート作成が済んでいるか
    if (!window._shareText) {
      alert('先に「ルートを作る」を押して、経路を作成してください。');
      return;
    }

    // ④ 共有（ユーザーがキャンセルした場合は res が undefined）
    const res = await liff.shareTargetPicker([{ type: 'text', text: window._shareText }]);
    if (res) {
      alert('送信しました！');
    }
  } catch (e) {
    // ⑤ 例外時に内容を表示
    alert('共有に失敗しました：\n' + (e?.message || String(e)));
  }
}

  </script>
</body>
</html>






<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ツーリングルート共有（LINE × Google Maps）</title>
  <style>
    html, body { height: 100%; margin: 0; font-family: sans-serif; }
    header { padding: 10px 16px; background: #06c755; color: white; }
    h1 { font-size: 18px; margin: 0; }
    #map { width: 100%; height: 60vh; }
    .panel { padding: 12px 16px; }
    input { padding: 8px; width: 100%; margin-bottom: 8px; border: 1px solid #ccc; border-radius: 6px; }
    button { padding: 10px; font-size: 16px; border: none; border-radius: 8px; background: #06c755; color: white; width: 100%; }
    button:disabled { opacity: 0.5; }
  </style>
</head>
<body>
  <header><h1>ツーリングルート共有</h1></header>
  <div class="panel">
    <input id="start" placeholder="出発地を入力（例：京都駅）">
    <input id="end" placeholder="目的地を入力（例：美山 かやぶきの里）">
    <button id="makeRoute">ルートを作る</button>
    <button id="shareBtn" disabled>LINEで共有</button>
  </div>
  <div id="map"></div>
  <!-- 距離・時間の表示エリア（追加） -->
  <div class="panel" style="padding-top:8px">
  <div id="summary" style="font-size:14px;line-height:1.6;color:#333"></div>
</div>


  <!-- LINE SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
  <script>
    const LIFF_ID = "2008438848-3gJlGQvy"; // ← あなたのLIFF ID
    async function initLIFF() {
      await liff.init({ liffId: LIFF_ID });
      const canShare = liff.isApiAvailable('shareTargetPicker');
      document.getElementById('shareBtn').disabled = !canShare;
    }
    initLIFF();
  </script>

  <!-- Google Maps API -->
  <!-- Google Maps API（initMapを自動実行させる版） -->
  <script>
    const GOOGLE_MAPS_API_KEY = "AIzaSyBlN9ik-Y3CpEy3Uw9hXfBq0m2AoZWx_oM";
  </script>
  <script
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBlN9ik-Y3CpEy3Uw9hXfBq0m2AoZWx_oM&libraries=places&language=ja&callback=initMap"
    async defer></script>

  <script>
  let map, directionsService, directionsRenderer;
  document.getElementById('makeRoute').addEventListener('click', makeRoute);
  document.getElementById('shareBtn').addEventListener('click', shareOnLINE);

  function initMap() {
    map = new google.maps.Map(document.getElementById('map'), { center: { lat: 35.0116, lng: 135.7681 }, zoom: 9 });
    directionsService = new google.maps.DirectionsService();
    directionsRenderer = new google.maps.DirectionsRenderer({ map });
  }
  window.initMap = initMap;

  async function makeRoute() {
    const start = document.getElementById('start').value;
    const end = document.getElementById('end').value;
    if (!start || !end) { alert('出発地と目的地を入力してください'); return; }
    const req = { origin: start, destination: end, travelMode: google.maps.TravelMode.DRIVING };
    directionsService.route(req, (result, status) => {
if (status === 'OK') {
  directionsRenderer.setDirections(result);
  const leg = result.routes[0].legs[0];

  // 画面表示（そのまま）
  const s = document.getElementById('summary');
  s.textContent = `距離: ${leg.distance.text}　時間: ${leg.duration.text}`;

  // GoogleマップのルートURL（タップで地図アプリが開く）
  const gmapsUrl =
    'https://www.google.com/maps/dir/?api=1' +
    `&origin=${encodeURIComponent(leg.start_address)}` +
    `&destination=${encodeURIComponent(leg.end_address)}` +
    '&travelmode=driving';

  // 共有用データをまとめて保存（位置情報＋テキスト＋URL）
  window._sharePayload = {
    text:
      `出発地: ${leg.start_address}\n` +
      `目的地: ${leg.end_address}\n` +
      `距離: ${leg.distance.text}\n` +
      `時間: ${leg.duration.text}\n\n` +
      `ルートを見る: ${gmapsUrl}`,
    gmapsUrl,
    start: {
      title: '出発地',
      address: leg.start_address,
      lat: leg.start_location.lat(),
      lng: leg.start_location.lng(),
    },
    end: {
      title: '目的地',
      address: leg.end_address,
      lat: leg.end_location.lat(),
      lng: leg.end_location.lng(),
    }
  };

  // 従来のテキストも一応残しておく（フォールバック用）
  window._shareText =
    `出発地: ${leg.start_address}\n目的地: ${leg.end_address}\n距離: ${leg.distance.text}\n時間: ${leg.duration.text}\n\nルートを見る: ${gmapsUrl}`;

  // 共有ボタンを有効化
  document.getElementById('shareBtn').disabled = false;

} else {
  alert('ルートを作れませんでした');
  document.getElementById('summary').textContent = '';
}

// ===== 共有ボタン（スマホ/PC 両対応版） =====
async function shareOnLINE() {
  try {
    if (!window._shareText) {
      alert('先に「ルートを作る」で経路を作成してください。');
      return;
    }

    // 1) LINEアプリ内でShare Target Pickerが使える場合
    if (liff.isInClient() && liff.isApiAvailable('shareTargetPicker')) {
      const res = await liff.shareTargetPicker([{ type: 'text', text: window._shareText }]);
      if (res) alert('送信しました！');
      return;
    }

    // 2) それ以外（PCブラウザ、外部ブラウザなど）は共有URLで開く
    const shareUrl = 'https://line.me/R/share?text=' + encodeURIComponent(window._shareText);
    window.open(shareUrl, '_blank'); // ← PCでも動作（新しいタブでLINE共有ページ）
  } catch (e) {
    alert('共有に失敗しました：\n' + (e?.message || String(e)));
  }
}

  </script>
</body>
</html>









